<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>商城</title>
    <link rel="icon" href="./static/awei.jpg">
    <!-- 新 Bootstrap5 核心 CSS 文件 -->
    <link href="https://cdn.staticfile.org/twitter-bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">

    <!-- 最新的 Bootstrap5 核心 JavaScript 文件 -->
    <script src="https://cdn.staticfile.org/twitter-bootstrap/5.1.3/js/bootstrap.min.js"></script>
    <!-- popper.min.js 用于弹窗、提示、下拉菜单 -->
    <script src="https://cdn.staticfile.org/popper.js/2.9.3/umd/popper.min.js"></script>
</head>
<body style="background-image: url(./static/bg.jpg)">
<nav class="navbar navbar-dark bg-dark navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
        <a class="navbar-brand" href="http://localhost:8080/test/welcome.html">欢迎</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="http://localhost:8080/test/cart.html">购物车</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="http://localhost:8080/test/item.html">商城</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        个人中心
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <li><a class="dropdown-item" href="#">修改密码</a></li>
                        <li><a class="dropdown-item" href="#">注销账户</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#">其他功能</a></li>
                    </ul>
                </li>
                <li class="nav-item">
                    <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">实验四</a>
                </li>
            </ul>
            <form class="d-flex">
                <input class="form-control me-2" type="search" placeholder="正在开发中" aria-label="Search">
                <button class="btn btn-outline-success" type="submit">搜索</button>
            </form>
        </div>
    </div>
</nav>
    <div class="d-flex flex-column mb-3 d-grid gap-3">
        <div class="row">
            <div class="card col-3 border border-5 border-dark">
                <div class="card-header">
                    <img src="./static/intel.png" class="rounded" alt="轮播图" style="width: 100%">
                </div>
                <div id="1" class="card-body">
                </div>
                <div class="card-footer" >
                   <button type="button" class="btu btn-warning" value="1">添加进购物车</button>
                </div>
            </div>
            <div class="col-1">

            </div>

            <div class="card col-3 border border-5 border-dark">
                <div class="card-header">
                    <img src="./static/intel.png" class="rounded" alt="轮播图" style="width: 100%">
                </div>
                <div id="2" class="card-body">
                </div>
                <div class="card-footer" >
                    <button type="button" class="btu btn-warning" value="2">添加进购物车</button>
                </div>
            </div>

            <div class="col-1">

            </div>

            <div class="card col-3 border border-5 border-dark">
                <div class="card-header">
                    <img src="./static/intel.png" class="rounded" alt="轮播图" style="width: 100%">
                </div>
                <div id="3" class="card-body">
                </div>
                <div class="card-footer" >
                    <button type="button" class="btu btn-warning" value="3">添加进购物车</button>
                </div>
            </div>
        </div>
    </div>

    <div class="d-flex flex-column mb-3">
        <div class="row">
            <div class="card col-3 border border-5 border-dark">
                <div class="card-header">
                    <button type="button" class="btu btn-warning" value="4">添加进购物车</button>
                </div>
                <div id="4" class="card-body">
                </div>
                <div class="card-footer">
                    <img src="./static/intel.png" class="rounded" alt="轮播图" style="width: 100%">
                </div>
            </div>

            <div class="col-1">

            </div>

            <div class="card col-3 border border-5 border-dark">
                <div class="card-header">
                    <button type="button" class="btu btn-warning" value="5">添加进购物车</button>
                </div>
                <div id="5" class="card-body">
                </div>
                <div class="card-footer">
                    <img src="./static/intel.png" class="rounded" alt="轮播图" style="width: 100%">
                </div>
            </div>

            <div class="col-1">

            </div>

            <div class="card col-3 border border-5 border-dark">
                <div class="card-header">
                    <button type="button" class="btu btn-warning" value="6">添加进购物车</button>
                </div>
                <div id="6" class="card-body">
                </div>
                <div class="card-footer">
                    <img src="./static/intel.png" class="rounded" alt="轮播图" style="width: 100%">
                </div>
            </div>
        </div>
    </div>
    <div class="p-2 fixed-bottom">
        <nav aria-label="Page navigation example">
            <ul class="pagination justify-content-center">
                <li class="page-item">
                    <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Previous</a>
                </li>
                <li class="page-item"><a class="page-link" href="#">1</a></li>
                <li class="page-item"><a class="page-link" href="#">2</a></li>
                <li class="page-item"><a class="page-link" href="#">3</a></li>
                <li class="page-item">
                    <a class="page-link" href="#">Next</a>
                </li>
            </ul>
        </nav>
    </div>
</body>
<script type="text/javascript" src="jquery-3.6.0.js"></script>
<script src="https://cdn.staticfile.org/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script type="text/javascript">
    var page = 0;
    var item = new Array(6);
    var cookie = $.cookie('userId');
    function pageing(page){
        $.ajax({
            url:"http://localhost:8080/test/item/paging",
            data:{
                page:page,
                size:6
            },
            type:'post',
            contentType: 'application/x-www-form-urlencoded;charset=UTF-8',
            data_type:'json',
            success:function (data){
                $.each(data, function (index,obj){
                    item[index] = obj['id']
                    let html = "";
                    let num = index + 1;
                    let st = "#" + num;
                    if (num<4){
                        html += "<div id="+ num +" className=\"card-body\">";
                        html += "<p class=\"fw-bold\">" +"商品名称： "+obj['name'] +"</p>";
                        html += "<p class=\"fw-normal\">" +"商品剩余数量： " +obj['number'] +"</p>";
                        html += "<p class=\"fs-3\">" +"商品价格： ￥"+ obj['price'] + "</p>"
                        html += "</div>"
                    }else {
                        html += "<div id="+ num +" className=\"card-body\">";
                        html += "<p class=\"fw-bold\">" +"商品名称： "+obj['name'] +"</p>";
                        html += "<p class=\"fw-normal\">" +"商品剩余数量： " +obj['number'] +"</p>";
                        html += "<p class=\"fs-3\">" +"商品价格： ￥"+ obj['price'] + "</p>"
                        html += "</div>"
                    }

                    $(st).replaceWith(html);
                })
            },
            error:function (){
                alert("出错了")
            }
        })
    }

    $(function (){
        pageing(page);
    })

    $("button").click(function (){
        let val = $(this).val();
        let id = item[val-1]
        $.ajax({
            url:"http://localhost:8080/test/item/add",
            data: {
                itemId:id,
                userId:cookie
            },
            type:'post',
            contentType: 'application/x-www-form-urlencoded;charset=UTF-8',
            data_type:'json',
            success:function (data){
                if (data){
                    alert("添加成功")
                }
            },
            error:function (){
                alert("添加失败")
            }
        })
    })

    /*分页*/
    $("a").click(function (){
        var text = $(this).text();

        if (text==='Previous'){
            page--;
            if (page=== -1){
                page = 2;
            }
        }else if (text==='Next'){
            page++;
            if (page===3){
                page = 0;
            }
        }else {
            page = text - 1;
        }
        pageing(page);
    })
</script>
</html>
